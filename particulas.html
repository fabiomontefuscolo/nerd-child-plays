<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Particulas</title>
        <style type="text/css">
            html { height: 100% }
            body { height: 100%; margin: 0; padding: 0 }
            #canvas {
                width: 100%;
                height: 100%
            }
        </style>
        <script type="application/x-javascript">
            var G = 0.1;

            var Particle = function(sx, sy, vx, vy, boundaries) {
                var context = null;
                var color = "#"+Math.round(0xffffff * Math.random()).toString(16);
                var size = 10;
                var fid = 0;
                var factor = Math.random();

                function update() {
                    erase();

                    sy = sy + vy + G/2;
                    vy = vy + G;

                    if(sy + size >= boundaries.max_y) {
                        vx = vx * factor;

                        if(Math.abs(vy) > 0.5) {
                            vy = -1 * factor * Math.abs(vy);
                        } else {
                            vy = 0;
                            sy = sy - G/2
                        }
                    }

                    if(sx < 1 || sx + size >= boundaries.max_x) {
                        vx = -1 * vx;
                    }

                    sx = sx + vx;


                    draw();
                }

                function erase() {
                    context.fillStyle = "#FFFFFF";
                    context.fillRect(sx-1, sy-1, size+2, size+2); //Sem rastro
                    //context.fillRect(sx, sy, 5, 5); //Com rastro
                }

                function draw() {
                    context.fillStyle = color;
                    context.fillRect(sx, sy, size, size);
                }

                this.start = function() {
                    fid = setInterval(update, 10);
                }

                this.stop = function() {
                    clearInterval(fid);
                    fid = 0;
                }

                this.setContext = function(c) {
                    context = c;
                }

                this.setColor = function(c) {
                    color = c;
                }
            }

            function start() {
                var canvas = document.getElementById('canvas');
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;

                var c = canvas.getContext('2d');
                c.fillStyle = "#FFFFFF";
                c.fillRect(0, 0, canvas.width, canvas.height);
                c.fillStyle = "#000000";

                for( var i = 0; i < 34; i++ ) {
                    var p = new Particle(
                        400,
                        300,
                        Math.random() * 10 - 5,
                        Math.random() * 10 - 5,
                        { max_x: canvas.width, max_y: canvas.height }
                    );
                    p.setContext(c);
                    requestAnimationFrame(p.start.bind(p));
                }
            }

            window.onload = start;
        </script>
    </head>
    <body>
        <canvas id="canvas"></canvas>
    </body>
</html>
